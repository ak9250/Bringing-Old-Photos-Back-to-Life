entrypoint: python runway_model.py
python: 3.6
cuda: 9.2
spec:
  gpu: True
  cpu: False
build_steps:
  - apt-get update
  - apt-get install -y git bzip2 wget unzip cmake libgl1-mesa-dev libgtk2.0-dev
  - apt-get install ffmpeg libsm6 libxext6  -y
  - pwd
  - ls
  # pull the syncBN repo
  - cd Face_Enhancement/models/networks/
  - pwd
  - git clone https://github.com/vacancy/Synchronized-BatchNorm-PyTorch
  - cp -rf Synchronized-BatchNorm-PyTorch/sync_batchnorm .
  - cd ../../../

  - cd Global/detection_models/
  - pwd
  - git clone https://github.com/vacancy/Synchronized-BatchNorm-PyTorch
  - cp -rf Synchronized-BatchNorm-PyTorch/sync_batchnorm .
  - cd ../../

# download the landmark detection model
  - cd Face_Detection/
  - wget http://dlib.net/files/shape_predictor_68_face_landmarks.dat.bz2
  - bzip2 -d shape_predictor_68_face_landmarks.dat.bz2
  - cd ../

# download the pretrained model
  - cd Face_Enhancement/
  - wget https://facevc.blob.core.windows.net/zhanbo/old_photo/pretrain/Face_Enhancement/checkpoints.zip
  - unzip checkpoints.zip -y
  - cd ../

  - cd Global/
  - wget https://facevc.blob.core.windows.net/zhanbo/old_photo/pretrain/Global/checkpoints.zip
  - unzip checkpoints.zip -y
  - cd ../

  - pip install -r requirements.txt
